---
title: "Session 5 Assignment"
output:
  html_document:
    df_print: tibble
---

## Google Analytics with R

```{r}
library(dplyr, warn.conflicts = FALSE)
library(tidyverse, warn.conflicts = FALSE)
suppressPackageStartupMessages(library(tidyverse)) # suppress startup message
options(dplyr.summarise.inform = FALSE) # Suppress summarise info
library(googleAnalyticsR)
```


```{r}
ga <- read.csv("~/Projects/DATA104/Assignment 5/ga_data.csv")
```

```{r}
ga$date <- as.Date(ga$date)
ga$dayOfWeek <- as.factor(ga$dayOfWeek)
ga$hour <- as.integer(ga$hour)
ga$users <- as.integer(ga$users)
ga$sessions <- as.integer(ga$sessions)
ga$bounces <- as.integer(ga$bounces)
```


```{r}
str(ga)
```

### Show top and bottom records

```{r}
head(ga)
tail(ga)
```

###  Summary Statistics

** fix thid to only have data / sessinos / users / bounes

```{r}
ga %>% 
  select(date, sessions, users, bounces) %>% 
  summary()
```


```{r}

```

 * **Date**: the summary statistics for the date show you with the min/max values the start and end dates of your dataset.  The median additionally shows you the mid point.
  * **Day of Week**: Because this data is a Factor, this simply tells us how many days of each day of the week are in the set. Since there are 24 hours in a day, dividing the numbers in day of week gives us 5 days for "2", "3", and "4" and 4 for the rest.
 * **Hour**: Represents the hours in a day from 0-23 (24 hours)
 * **Users**: The number of total unique users per period.  In our case hourly samples.  There were at max 25 users in a single one hour period of time and a min of 0.
 * **Sessions**: The max number of sessions in any given hour here was 25, equal to the number of users.  We might see this number be higher than the users on a traditional web site, however here we see that each users is essentially visiting it once.  
 * **Bounces**: The max bounce rate is 21 showing us that *most* users are bouncing after a single page is viwed.  To be understood given this sample web site doesn't have much to navigate through.

```{r}
cum_sesson_totals <- ga %>%
  group_by(date)  %>%
  summarize(total_sessions = sum(sessions), .groups = 'keep')
cum_sesson_totals
```
## How many days had 0 sessions? Which days? (use cum_sesson_totals)

```{r}
length(which(cum_sesson_totals$total_sessions == 0))
```


```{r}
cum_sesson_totals %>%
  filter(total_sessions == 0)
```

## How many days with 1 or more sessions? Which days? (use cum_sesson_totals)

```{r}
length(which(cum_sesson_totals$total_sessions >= 1))
```


```{r}
at_least_one_session <- cum_sesson_totals %>%
  filter(total_sessions >= 1)

at_least_one_session
```

## contingency table with total sessions by date (for dates with 1 or more sessions)

```{r}
# contingency table that shows the days that have at least 1 session
addmargins(with(at_least_one_session, table(date, total_sessions, dnn = c('date', 'total_sessions'))))
```


## Create a time series (eg: line chart) with sessions by day (use cum_sesson_totals )


```{r}
ggplot(cum_sesson_totals, mapping = aes(x = date, y = total_sessions)) + 
  geom_line(color = 'black') + 
  theme_minimal()
```
The page was mostly idle until October 5th.  The site was shared on various social media sites and produced an influx of new users.  

## Create a scatter plot with a trend line showing sessions over time (use cum_sesson_totals)

```{r}
ggplot(cum_sesson_totals, mapping = aes(x = date, y = total_sessions)) + 
  geom_point(color = 'black', alpha = 0.5) +
  geom_line(color = 'gray', alpha = 0.5) + 
  geom_smooth() +
  theme_minimal()
```

## Create a new dataframe called cum_dayofweek_totals, with session totals by date and dayOfWeek

```{r}
cum_dayofweek_totals = ga %>%
  group_by(date, dayOfWeek)  %>%
  summarize(total_sessions = sum(sessions), .groups = 'keep')
```

## Create boxplots showing the number of sessions by day of week (use cum_dayofweek_totals)

```{r}
ggplot(cum_dayofweek_totals, aes(x = dayOfWeek, y = total_sessions)) + 
  geom_boxplot() +
  theme_minimal()
```

## Create a new dataframe called cum_users_totals, with user totals by hour and dayOfWeek

```{r}
cum_user_totals = ga %>%
  select(hour, dayOfWeek, users)  %>%
  group_by(hour, dayOfWeek, users) %>%
  summarize(total_users = sum(users), .groups = 'keep')

cum_user_totals
```


```{r}
ggplot(cum_user_totals, aes(x = dayOfWeek, y = hour, fill = users)) + 
  geom_tile(color = "gray") +
  scale_fill_gradient(low="white", high="blue") + 
  theme_gray() +
  scale_x_discrete(labels = c('Sun', 'Mon', 'Tues', 'Wed', 'Thur', 'Fri', 'Sat'),guide = guide_axis(angle = 90)) +
  ggtitle("Users by Time of Day") +
  xlab("Day of the Week") + 
  ylab("Hour of the Day (24h Scale)")
```

