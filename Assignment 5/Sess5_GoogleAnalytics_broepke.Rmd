---
title: "Session 5 Assignment"
output:
  html_document:
    df_print: tibble
---

## Google Analytics with R

```{r}
library(tidyverse)
library(dplyr, warn.conflicts = FALSE)
library(googleAnalyticsR)
library(ggplot2)
```


```{r}
my_path <- "~/Projects/DATA104/Assignment 5/ga_data.csv"
ga <- read.csv(my_path)
```

```{r}
ga$date <- as.Date(ga$date)
ga$dayOfWeek <- as.factor(ga$dayOfWeek)
ga$hour <- as.integer(ga$hour)
ga$users <- as.integer(ga$users)
ga$sessions <- as.integer(ga$sessions)
ga$bounces <- as.integer(ga$bounces)
```


```{r}
str(ga)
```

### Show top and bottom records

```{r}
head(ga)
tail(ga)
```

### Show statistic Summary

 * TODO Describe your observations in words.

```{r}
summary(ga)
```

Describe the output

```{r}
cum_sesson_totals = ga %>%
  group_by(date)  %>%
  summarize(total_sessions = sum(sessions), .groups = 'keep')
cum_sesson_totals
```
## How many days had 0 sessions? Which days? (use cum_sesson_totals)

```{r}
length(which(cum_sesson_totals$total_sessions == 0))
```


```{r}
cum_sesson_totals %>%
  filter(total_sessions == 0)
```

## How many days with 1 or more sessions? Which days? (use cum_sesson_totals)

```{r}
length(which(cum_sesson_totals$total_sessions >= 1))
```


```{r}
at_least_one_session <- cum_sesson_totals %>%
  filter(total_sessions >= 1)

at_least_one_session
```

## contingency table with total sessions by date (for dates with 1 or more sessions)

```{r}
# contingency table that shows the days that have at least 1 session
addmargins(with(at_least_one_session, table(date, total_sessions, dnn = c('date', 'total_sessions'))))
```

## Informational only (donâ€™t need to include)

```{r}
df = ga %>%
  subset(sessions > 0) %>%
  group_by(date, hour)  %>%
  summarize(sessions)

df
```

```{r}
# contingency table that shows the days that have at least 1 session
addmargins(with(df, table(date, sessions, dnn = c('date', 'sessions'))))
```

```{r}
# filter by session on 9/6 to confirm that 9/16 has 6 sessions
ga  %>%
  filter(date=='2020-09-24' & sessions > 0) %>%
  summarize(date, hour, sessions)
```

## Create a time series (eg: line chart) with sessions by day (use cum_sesson_totals )


```{r}
ggplot(cum_sesson_totals, mapping = aes(x = date, y = total_sessions)) + 
  geom_line(color = 'black') + 
  theme_minimal()
```


## Create a scatter plot with a trend line showing sessions over time (use cum_sesson_totals)

```{r}
ggplot(cum_sesson_totals, mapping = aes(x = date, y = total_sessions)) + 
  geom_point(color = 'black', alpha = 0.5) + 
  geom_smooth() +
  theme_minimal()
```

## Create a new dataframe called cum_dayofweek_totals, with session totals by date and dayOfWeek

```{r}
cum_dayofweek_totals = ga %>%
  group_by(date, dayOfWeek)  %>%
  summarize(total_sessions = sum(sessions), .groups = 'keep')
cum_dayofweek_totals
```

## Create boxplots showing the number of sessions by day of week (use cum_dayofweek_totals)

```{r}
ggplot(cum_dayofweek_totals, aes(x = dayOfWeek, y = total_sessions)) + 
  geom_boxplot() +
  theme_minimal()
```

## Create a new dataframe called cum_users_totals, with user totals by hour and dayOfWeek

```{r}
cum_user_totals = ga %>%
  select(hour, dayOfWeek, users)  %>%
  group_by(hour, dayOfWeek, users) %>%
  summarize(total_users = sum(users), .groups = 'keep')

cum_user_totals
```


```{r}
ggplot(cum_user_totals, aes(x = dayOfWeek, y = hour, fill = users)) + 
  geom_tile(color = "gray") +
  scale_fill_gradient(low="white", high="blue") + 
  theme_gray() +
  scale_x_discrete(labels = c('Sun', 'Mon', 'Tues', 'Wed', 'Thur', 'Fri', 'Sat'),guide = guide_axis(angle = 90)) +
  ggtitle("Users by Time of Day") +
  xlab("Day of the Week") + 
  ylab("Hour of the Day (24h Scale)")
```

