---
title: "Facebook EDA"
author: "Brian Roepke"
date: "Oct 4, 2020"
output: html_document
---
# Project Description

Perform Exploratory Data Analysis on the provided dataset. Refer to your reading on EDA as well as referenced resources provided in this notebook, e-learning and elsewhere. 
**Your project MUST include meaningful analysis with description, similar to the EDA sample provided.**

```{r}
library(dplyr, warn.conflicts = FALSE) # suppress conflicts warning
library(tidyr)
library(ggplot2)
```

```{r}
fb <- read.csv("Facebook FriendsCSV.csv", skip = 2)
```

```{r}
str(fb)
```

```{r}
names(fb)
```

# Data Prep
Observe the following:

 * X..of..Tags column name was generated due to spaces in the column name. Rename this to Tags
 * The Friend field is not a data field but represents an instance (715 in total), and is not needed
 * Fields with values 0 and 1 are actually categorical (eg: Emp,Profile, Edu, Events, USA, etc..)
 * Gender is categorical ((Male=1; Female=0, 2=Other/Unknown)
 * Fields ‘Photos’ and ‘Friends’ were treated as character when they should be numeric. We can use regular expressions to show which values are causing the data to be treated as chr
 * Remaining fields are continuous

## To Do
1. Rename ‘X of Tags’ to ‘Tags’.
2. Change the datatype from character to integer (Friends, Photos). To do this, need to remove the commas first, using gsub.

```{r}
# Rename ‘X of Tags’ to ‘Tags’.

fb <- rename(fb, "Tags" = "X..of.Tags")
```

```{r}
# Change the datatype from character to integer (Friends, Photos). To do this, need to remove the commas first, using gsub.

fb$Photos <- as.integer(gsub(",","", fb$Photos))
fb$Friends <- as.integer(gsub(",","", fb$Friends))
```

## Verify by looking at the structure again

```{r}
str(fb)
```

## Let’s take a look at the distribution of Age.

```{r}
summary(fb$Age)
```

We see that the min Age is 13, max is 81, average is 24. For plotting, create age groups: 13–17, 18–24, 25–34, 35–44, 45–54, 55-64, 65+

Reference:
https://www.statista.com/statistics/376128/facebook-global-user-age-distribution/

# Data wrangling/munging/transformation
Refers to the process of cleaning, structuring, enriching raw data into a format compatible for down stream processing such as analysis, plotting, etc. Perform the following transformations:

 * Remove Friend field as it is not needed
 * Convert to categorical fields to factors
    * Add AgeGroup (13–17, 18–24, 25–34, 35–44, 45–54, 55-64, 65+)
    * Update Gender values (male=1; female=0, 2=other)
    * Update Sexual Orientation values (1=heterosexual; 0=other)
    * Add InRelationship (1=yes; 0=no) and remove Relationship
    * Update Emp values (employed=1, unemployed=0)
    * Add HasCollege with yes/no: based on Edu where (1=High School or less; 0=college) then remove Edu
    * Update USA values (yes=1; no=0)
    * Add ProfilePic (1=self; 0=other) and remove Profile
    * Add CoverPic (1=self; 0=other) and remove Cover
    * Midwest, Southeast, West are represented. Update their values to be yes/no.
    * But there are observations not represented in these groups. Add a Region column with values: (MidWest, Seast,West, Other) respectively

```{r}
# Remove Friend field as it is not needed

fb$Friend <- NULL
```


```{r}
# Add AgeGroup (13–17, 18–24, 25–34, 35–44, 45–54, 55-64, 65+)

fb <- fb %>% 
  mutate(AgeGroup = case_when(Age >= 13  & Age <= 17 ~ '13–17', 
                              Age >= 18  & Age <= 24 ~ '18-24',
                              Age >= 25  & Age <= 34 ~ '25-34',
                              Age >= 35  & Age <= 44 ~ '35-44',
                              Age >= 45  & Age <= 54 ~ '45-54',
                              Age >= 55  & Age <= 64 ~ '55-64',
                              Age >= 65 ~ '65+'))

fb$AgeGroup <- as.factor(fb$AgeGroup)
```

```{r}
# Update Gender values (male=1; female=0, 2=other)

fb$Gender[fb$Gender == 1] <- 'Male'
fb$Gender[fb$Gender == 0] <- 'Female'
fb$Gender[fb$Gender == 2] <- 'Other'

fb$Gender <- as.factor(fb$Gender)
```

```{r}
# Update Sexual Orientation values (1=heterosexual; 0=other)

fb$Orientation[fb$Orientation == 1] <- 'Heterosexual'
fb$Orientation[fb$Orientation == 0] <- 'Other'

fb$Orientation <- as.factor(fb$Orientation)
```

```{r}
# Add InRelationship (1=yes; 0=no) and remove Relationship

fb <- fb %>% 
  mutate(InRelationship = case_when(Relationship == 1 ~ 'Yes',
                                    Relationship == 0 ~ 'No'))

fb$InRelationship <- as.factor(fb$InRelationship)
fb$Relationship <- NULL
```

```{r}
# Update Emp values (employed=1, unemployed=0)

fb$Emp[fb$Emp == 1] <- 'Employed'
fb$Emp[fb$Emp == 0] <- 'Unemployed'

fb$Emp <- as.factor(fb$Emp)
```

```{r}
# Add HasCollege with yes/no: based on Edu where (1=High School or less; 0=college) then remove Edu

fb <- fb %>% 
  mutate(HasCollege = case_when(Edu == 1 ~ 'High School or Less',
                                Edu == 0 ~ 'College'))

fb$HasCollege <- as.factor(fb$HasCollege)
fb$Edu <- NULL
```

```{r}
# Update USA values (yes=1; no=0)

fb$USA[fb$USA == 1] <- 'Yes'
fb$USA[fb$USA == 0] <- 'No'

fb$USA <- as.factor(fb$USA)
```

```{r}
# Add ProfilePic (1=self; 0=other) and remove Profile

fb <- fb %>% 
  mutate(ProfilePic = case_when(Profile == 1 ~ 'Self',
                                Profile == 0 ~ 'Other'))


fb$ProfilePic <- as.factor(fb$ProfilePic)
fb$Profile <- NULL
```

```{r}
# Add CoverPic (1=self; 0=other) and remove Cover

fb <- fb %>% 
  mutate(CoverPic = case_when(Cover == 1 ~ 'Self',
                              Cover == 0 ~ 'Other'))


fb$CoverPic <- as.factor(fb$CoverPic)
fb$Cover <- NULL
```

```{r}
# Midwest, Southeast, West are represented. Update their values to be yes/no.

fb$MidWest[fb$MidWest == 1] <- 'Yes'
fb$MidWest[fb$MidWest == 0] <- 'No'

fb$Seast[fb$Seast == 1] <- 'Yes'
fb$Seast[fb$Seast == 0] <- 'No'

fb$West[fb$West == 1] <- 'Yes'
fb$West[fb$West == 0] <- 'No'

fb$MidWest <- as.factor(fb$MidWest)
fb$Seast <- as.factor(fb$Seast)
fb$West <- as.factor(fb$West)
```

```{r}
# But there are observations not represented in these groups. Add a Region column with values: (MidWest, Seast,West, Other) respectively

fb <- fb %>% 
  mutate(Region = case_when(MidWest == 'No'  & Seast == 'No' & West == 'No' ~ 'Other',
                           MidWest == 'Yes' ~ 'MidWest',
                           Seast == 'Yes' ~ 'Seast',
                           West == 'Yes' ~ 'West'))

fb$Region <- as.factor(fb$Region)
```

```{r}
str(fb)
```


## Verify Location values
 * create a table showing the new Location values.
 * show top 10 region/location values

```{r}
select(fb, MidWest, Seast, West, Region, USA) %>%
  head(10)
```

```{r}
summary(fb$Region)
```

## Show Top and Bottom observations

```{r}
head(fb)
```

```{r}
tail(fb)
```


# Exploratory Data Analysis (EDA)
 * Show stats, graphs and other exploratory techniques to gain insight.
 * What are your questions? For example, perhaps I’m interested in understanding which variables contribute to the # of Friends. Using this information I can crearte a model that predicts the number of facebook friends.

## Display summary statistics to better understand data distributions by variable.
 * For continuous variables, you have measures of dispersion such as min, max, et…
 * For categorical (factors), you have counts by grouping

```{r}
summary(fb)
```

## Graphs and plots

### Univariant

Plots of single variables to understand shape, distribution, et

```{r}
ggplot(fb) +
  geom_bar(aes(x = AgeGroup))

ggplot(fb) +
  geom_bar(aes(x = Gender))

ggplot(fb) +
  geom_histogram(aes(x = Friends))

ggplot(fb) +
  geom_histogram(aes(x = Posts))
```


### Multivariate

Plots of multiple variables to look for relationships, etc..

```{r}
ggplot(fb) +
  geom_bar(aes(x = AgeGroup, fill = Emp))

ggplot(fb) +
  geom_bar(aes(x = AgeGroup, fill = HasCollege))

ggplot(fb) +
  geom_bar(aes(x = HasCollege, fill = Gender))

ggplot(fb) +
  geom_bar(aes(x = Emp, fill = HasCollege))

ggplot(fb, mapping = aes(x = Posts, y = Friends, color = Gender)) + 
  geom_point(na.rm = TRUE)

ggplot(fb, mapping = aes(x = Age, y = Posts, color = Gender)) + 
  geom_point(na.rm = TRUE)

ggplot(fb, mapping = aes(x = Age, y = Gender, color = Gender)) + 
  geom_boxplot(na.rm = TRUE) +
  coord_flip()
```

```{r}
ggplot(fb) + 
  geom_point(aes(x = Friends, y = Age, color = Gender)) + 
  facet_wrap(~ Gender, nrow = 2)
```


### Regression Analysis
Now that we’ve conducted EDA, we will create regression model(s) to predict some continuous value. Eg: predict the ‘# of Friends’.

 * Create a multiple linear regression model to predict ‘# of friends’ with only continuous predictor variables (x).
 * Select which x variables should be used in the regression model given correlation analysis. DO NOT split the dataset (use all) and no need to call predict. Only create the model, show its summary and speak to the model equation and what it means.
 * Refer to references and lecture notes

```{r}
fb2 = fb %>% 
  select_if(is.numeric)

 str (fb2)
```

```{r}
cor(fb2)
```

```{r}
library(car)
car::vif(lm(Friends ~., data = fb2))
```

